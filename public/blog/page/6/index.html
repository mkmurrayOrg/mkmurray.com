
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Mike Murray</title>
	<meta name="author" content="Mike Murray">

	
	<meta name="description" content="I actually read about this topic a while back when I saw a C# code sample containing an unfamiliar keyword &#8211; yield.&#160; Well just today I &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="http://feeds.feedburner.com/mkmurray/" rel="alternate" title="Mike Murray" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<link href='http://alexgorbatchev.com/pub/sh/current/styles/shCore.css' rel='stylesheet' type='text/css'/>
<link href='http://alexgorbatchev.com/pub/sh/current/styles/shThemeRDark.css' rel='stylesheet' type='text/css'/>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shAutoloader.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCpp.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCSharp.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCss.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPlain.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPowerShell.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushRuby.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushSql.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js' type='text/javascript'></script>
<script type='text/javascript'>
     SyntaxHighlighter.config.bloggerMode = true;
     SyntaxHighlighter.all();
</script>

</head>

<body>
	<div class="container">
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">


    <article class="post">
	<h1 class="title"><a href="/blog/2009/03/02/the-yield-keyword-in-c-aka-execution-control-hot-potato/">The &#8220;Yield&#8221; Keyword in C# (AKA Execution Control Hot Potato)</a></h1>
	<div class="meta">
		<div class="date">








  


<time datetime="2009-03-02T17:51:00-07:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2009</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/-net/'>.NET</a>, <a class='category' href='/blog/categories/c-/'>C#</a>, <a class='category' href='/blog/categories/linq/'>LINQ</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>


</div>
		
			<span class="comments"><a href="/blog/2009/03/02/the-yield-keyword-in-c-aka-execution-control-hot-potato/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content">
		<div class='post'>
<p>I actually read about this topic a while back when I saw a C# code sample containing an unfamiliar keyword &#8211; <font face="Courier New">yield</font>.&#160; Well just today I saw another code sample using this keyword again, and had since forgotten everything I had learned.&#160; As I Googled the topic again, I happened across the same article I read back then, a terrific blog post by <a href="http://flimflan.com/blog/">Joshua Flanagan</a>.&#160; Here is a link to Joshua&#8217;s simple introduction to the <font face="Courier New">yield</font> C# keyword:</p>  <p><a href="http://flimflan.com/blog/ThePowerOfYieldReturn.aspx">The power of yield (return)</a></p>  <p>I would also suggest the following MSDN article as well:</p>  <p><a href="http://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx">yield (C# Reference)</a></p>  <p>I&#8217;ll give you the gist of this .NET 2.0 feature.&#160; If you have a method that returns an iterative collection and the consumers of your function will only need <a title="foreach, in (C# Reference)" href="http://msdn.microsoft.com/en-us/library/ttw7t8t6.aspx"><font face="Courier New">foreach</font></a>, read-only access to that collection, then it is good practice to have your method return the universal <font face="Courier New">IEnumerable</font> collection (as opposed to you arbitrarily selecting an implementation-specific collection to be forced upon the consumers of your code).&#160; In C#, when you are returning an <font face="Courier New">IEnumerable</font> collection from a method, you are allowed to use the <font face="Courier New">yield</font> keyword in order to transform your method into what Microsoft calls an &quot;iterator block&quot;.&#160; Here is a quote from the MSDN article I mentioned above to explain this phrase and the <font face="Courier New">yield</font> keyword:</p> <span class='fullpost'> <blockquote>   <p>&quot;The <strong>yield</strong> keyword signals to the compiler that the method in which it appears is an iterator block.&#160; The compiler generates a class to implement the behavior that is expressed in the iterator block.&#160; In the iterator block, the <strong>yield</strong> keyword is used together with the <strong>return</strong> keyword to provide a value to the enumerator object.&#160; This is the value that is returned, for example, in each loop of a <strong>foreach</strong> statement.&#160; The <strong>yield</strong> keyword is also used with <strong>break</strong> to signal the end of iteration.&quot;</p> </blockquote>  <p>You are essentially building an enumerator (or iterator), and with each iteration of your <font face="Courier New">foreach</font> loop in the calling, consuming code, you are executing your method containing the iterator block until it reaches a <font face="Courier New">yield return</font> statement.&#160; At this point, only one item at a time in the collection is returned back to the consuming <font face="Courier New">foreach</font> loop for immediate logic execution by the body of the loop.&#160; On the next iteration of the consuming <font face="Courier New">foreach</font> loop, the method containing the iterator block will be called again and another single item in the collection will be returned for similar logic execution.</p>  <p>This game of execution control <a href="http://en.wikipedia.org/wiki/Hot_Potato_(game)">Hot Potato</a> has its benefits, in that you can stop the flip-flop of execution control when the music has stopped.&#160; In this analogy, I am comparing the &quot;music stopping&quot; to your code satisfying some logic that makes the rest of your <font face="Courier New">foreach</font> loop iterations unnecessary (perhaps you have found the one item in the collection you were looking for by meeting the sufficient requirements of an <font face="Courier New">if</font> statement).&#160; The benefit is that when you <font face="Courier New"><a title="break (C# Reference)" href="http://msdn.microsoft.com/en-us/library/adbctzc4.aspx">break</a></font> out of the consuming <font face="Courier New">foreach</font> loop before completing the iterations, you prevent wasteful code execution and memory use.&#160; This feature prevents one piece of code from fully populating a potentially large collection of items, just to have another consuming piece of code iterate partially through the list and then prematurely exit.&#160; Consider the savings especially when adding each item to the collection may be computationally intensive or if each item in the collection is itself a very large data structure.&#160; In the Hot Potato analogy, this would be as if the kids in the circle who didn&#8217;t touch the &quot;hot potato&quot; never existed in the game, saving floor space and unnecessary tosses to people you don&#8217;t really want to target for humiliating removal from the game.</p>  <p>For good sample code snippets of using the <font face="Courier New">yield</font> keyword, see the links provided above.</p>  <p>I hope to identify situations in the near future where I could benefit from using this C# keyword.&#160; Hopefully then I won&#8217;t forget a year down the road from now and then have to re-search the internet for Joshua&#8217;s blog post and the MSDN article to remind myself what I already learned.</p>  <p><strong><u>FOLLOWUP (03/26/09)</u></strong>:&#160; So I&#8217;m not sure how I missed it, but it took reading a very recent article by <a href="http://www.4guysfromrolla.com/ScottMitchell.shtml">Scott Mitchell</a> of <a href="http://www.4guysfromrolla.com/">4GuysFromRolla.com</a> to understand the real reason the <font face="Courier New">yield</font> keyword was introduced.&#160; The introduction of this keyword in .NET 2.0 was most helpful in the case of fulfilling the requirements of implementing the <font face="Courier New">IEnumerable</font> interface, which typically required you to create a sub-class that implemented <font face="Courier New">IEnumerator</font>.&#160; In many cases, it allowed you to take about 50 lines of code and turn it into 2 lines of code using the <font face="Courier New">yield</font> keyword.&#160; The introduction of LINQ brought heavy reliance on enumerating using the <font face="Courier New">yield</font> keyword in order to <a href="http://en.wikipedia.org/wiki/Pipeline_(software)">pipeline</a> <a href="http://en.wikipedia.org/wiki/Language_Integrated_Query#Standard_Query_Operators">query operators</a> together.&#160; Scott Mitchell takes you through this whole journey, tying all of the loose ends together to create a complete history of this keyword and how it&#8217;s most commonly utilized.&#160; Please visit the following article to get the whole picture:</p>  <ul>   <li><a href="http://aspnet.4guysfromrolla.com/articles/032509-1.aspx">An Extensive Examination of LINQ: The Ins and Outs of Query Operators</a></li> </ul> </span>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Esteban Araya</div>
<div class='content'>
Yield definitely seems like a more elegant way to build collections. I&#8217;ve used yield to generate a list of N random elements. Cool stuff.</div>
</div>
</div>

		
		
	</div>

</article>


    <article class="post">
	<h1 class="title"><a href="/blog/2009/02/19/sql-server-express-2005-remote-connections/">SQL Server Express 2005 Remote Connections</a></h1>
	<div class="meta">
		<div class="date">








  


<time datetime="2009-02-19T10:36:00-07:00" pubdate data-updated="true">Feb 19<span>th</span>, 2009</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/-net/'>.NET</a>, <a class='category' href='/blog/categories/asp-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/database/'>Database</a>, <a class='category' href='/blog/categories/error/'>Error</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>, <a class='category' href='/blog/categories/sql/'>SQL</a>


</div>
		
			<span class="comments"><a href="/blog/2009/02/19/sql-server-express-2005-remote-connections/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content">
		<div class='post'>
<p>I developed an ASP.NET site connecting to a local SQL Server Express 2005 instance on my development box.&#160; To further my informal testing, I wanted to host the site under IIS 7 on a Windows Server 2008 box, but I wanted to just use the same database remotely.&#160; I got the following error message when the site tried to hit the database:</p>  <blockquote>   <p>&quot;An error has occurred while establishing a connection to the server.&#160; When connecting to SQL Server 2005, this failure may be caused by the fact that under the default settings SQL Server does not allow remote connections.&#160; (provider: Named Pipes Provider, error: 40 - Could not open connection to SQL Server)&quot;</p> </blockquote>  <p>Apparently SQL Server Express 2005 is not automatically configured for remote access during installation (which really isn&#8217;t surprising as it is the Express version).&#160; Remote connections can be enabled though with a few relatively painless steps.&#160; See the following link for the procedure:</p>  <ul>   <li><a href="http://www.datamasker.com/SSE2005_NetworkCfg.htm">Configuring SQL Server Express 2005 for Remote Access when SQL Server does not allow remote connections</a></li> </ul>  <p>Hope this is helpful.</p>  </div>

		
		
	</div>

</article>


    <article class="post">
	<h1 class="title"><a href="/blog/2009/02/17/iis-7-and-asp-net-providers-membership-roles-and-profile/">IIS 7 and ASP.NET Providers (Membership, Roles, and Profile)</a></h1>
	<div class="meta">
		<div class="date">








  


<time datetime="2009-02-17T17:38:00-07:00" pubdate data-updated="true">Feb 17<span>th</span>, 2009</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/-net/'>.NET</a>, <a class='category' href='/blog/categories/asp-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/asp-net-providers-series/'>ASP.NET Providers Series</a>, <a class='category' href='/blog/categories/error/'>Error</a>, <a class='category' href='/blog/categories/iis/'>IIS</a>, <a class='category' href='/blog/categories/isapi/'>ISAPI</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>, <a class='category' href='/blog/categories/server-2008/'>Server 2008</a>, <a class='category' href='/blog/categories/vista/'>Vista</a>, <a class='category' href='/blog/categories/windows/'>Windows</a>


</div>
		
			<span class="comments"><a href="/blog/2009/02/17/iis-7-and-asp-net-providers-membership-roles-and-profile/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content">
		<div class='post'>
<p>I talked at length about the ASP.NET <a href="http://en.wikipedia.org/wiki/Provider_model">Provider Model pattern</a> and the ease of implementing several built-in services you can have for free with ASP.NET 2.0 in <a title="ASP.NET Providers - Membership, Role, and Profile" href="http://murrayon.net/2009/01/aspnet-providers-membership-role-and.html">my previous series of posts</a>.&#160; In this post, I will be discussing the advantages of using the ASP.NET Provider system under IIS 7 found in Windows Vista and Server 2008.&#160; I will also talk about an issue with using this Provider system to try and add authentication to an ASP.NET website that contains non-ASP.NET content, like static HTML pages.&#160; I think I&#8217;ll start with the discussion about non-ASP.NET content first.</p> <span class='fullpost'> <h3>IIS 7.0 Integrated Pipeline</h3>  <p>Since I don&#8217;t really understand much about <a title="Internet Server Application Programming Interface" href="http://en.wikipedia.org/wiki/ISAPI">ISAPI</a> filters and such, I&#8217;m just going to quote stuff from random pages on the <a href="http://www.iis.net/">official Microsoft IIS site</a>:</p>  <blockquote>   <p>&quot;IIS 6.0 and previous versions allowed the development of .NET application components via the ASP.NET platform. ASP.NET integrated with IIS via an ISAPI extension, and exposed its own application and request processing model. This effectively exposed two separate server pipelines, one for native ISAPI filters and extension components, and another for managed application components. ASP.NET components would execute entirely inside the ASP.NET ISAPI extension bubble and only for requests mapped to ASP.NET in the IIS script map configuration.</p>    <p>&quot;IIS 7.0 integrates the ASP.NET runtime with the core web server, providing a unified request processing pipeline that is exposed to both native and managed components known as modules.&quot;</p> </blockquote>  <p>and&#8230;</p>  <blockquote>   <p>&quot;This allows developers to fully extend the IIS 7.0 server with the richness of ASP.NET 2.0 and the .NET Framework, instead of using the lower level IIS C++ APIs. Existing ASP.NET applications also immediately benefit from tighter integration using existing ASP.NET features like Forms Authentication, Roles, and Output Caching for all content.&quot;</p> </blockquote>  <p>Note the last three words there:&#160; &quot;<font face="Courier New">for all content.</font>&quot;&#160; When I started this endeavor to implement the ASP.NET Provider system, I didn&#8217;t realize that it would really only apply to ASP.NET content and pages.&#160; I didn&#8217;t realize on IIS 6 I would have to fiddle with ISAPI filters and content filters to make my implementation work.&#160; And when I tried to doing a mapping (like <font face="Courier New">*.html</font> to the ASP.NET ISAPI DLL), I either didn&#8217;t do it right or it just isn&#8217;t very reliable and stable; here is a link to <a title="IIS problems with forms authentication &amp; HTML pages" href="http://forums.asp.net/t/1184547.aspx">the thread I followed in trying to make the appropriate changes in IIS 6</a>.&#160; I will note however that <a href="http://www.ultidev.com/products/Cassini/index.htm">UltiDev&#8217;s Cassini Web Server</a> can host such a site with absolutely no extra modification, where even IIS 7 required a little configuration.</p>  <p>By default in IIS 7, an <a title="IIS and ASP.NET: The Application Pool" href="http://www.developer.com/net/asp/article.php/2245511">application pool</a> runs using the <font face="Courier ne">Integrated</font> mode for the <font face="Courier New">Managed Pipeline</font> configuration.&#160; But there is also the option of <font face="Courier New">Classic</font> mode, which is helpful if you are needing strict compatibility with how you ran a website under IIS 6.&#160; In many cases, however, an existing ASP.NET website runs under <font face="Courier New">Integrated</font> mode without any problems.</p>  <h3>Configuring an ASP.NET Website to Run on IIS 7</h3>  <p>First, I think I will point you to a great video and document on Microsoft&#8217;s official IIS site that explains everything you really need to know.&#160; Then I will emphasize a few of the important points and also a gotcha or two.&#160; Here are the links you should reference:</p>  <ul>   <li><a href="http://learn.iis.net/page.aspx/377/using-aspnet-forms-authentication/">Using ASP.NET Forms Authentication</a> (video) </li>    <li><a href="http://learn.iis.net/page.aspx/243/aspnet-integration-with-iis7/">ASP.NET Integration with IIS 7.0</a> </li> </ul>  <p>The video above is also a terrific introduction to IIS 7.&#160; Below is a screenshot of IIS&#8217;s UI for configuring a website:</p>  <p><a href="http://lh6.ggpht.com/_rps657FzHZ0/SZtZDNleinI/AAAAAAAAACw/b2kq_6XIGD8/s1600-h/IIS_screenshot%5B5%5D.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="IIS_screenshot" src="http://lh5.ggpht.com/_rps657FzHZ0/SZtZDjlrIRI/AAAAAAAAAC0/cC29GwiAIhk/IIS_screenshot_thumb%5B3%5D.png?imgmax=800" width="475" height="368" /></a> </p>  <p>Notice the <font face="Courier New">ASP.NET</font> section and how it&#8217;s able to use your Providers to bring back Users, Roles, and Profile data back from the database.&#160; This UI reads from and writes to your <font face="Courier New">Web.config</font> and is really slick in my opinion.</p>  <p>The only real &quot;breaking change&quot; for running your website under IIS 7 is the fact that your <font face="Courier New">Web.config</font> might need a little migration to be compatible with <font face="Courier New">Integrated</font> mode.&#160; Apparently IIS gives you helpful error messages if it detects you haven&#8217;t run through the migration yet.&#160; The two most common things that ASP.NET websites have that require this migration are if you have declared <font face="Courier New">httpModules</font> or <font face="Courier New">httpHandlers</font> in your <font face="Courier New">Web.config</font>.&#160; The fix is to either copy or move these sections under <font face="Courier New">system.web</font> to their corresponding <font face="Courier New">system.webServer</font> sections.&#160; If you duplicate the sections, then you should be able run under both <font face="Courier New">Integrated</font> and <font face="Courier New">Classic</font> modes without any problems.&#160; You can even still run on IIS 6 I believe, as IIS 6 will ignore this new section called <font face="Courier New">system.webServer</font> which is IIS 7 specific.&#160; IIS 7 even provides a utility that can perform this migration for you; here is the what you would type in a Command Prompt:</p>  <p><font face="Courier New">%windir%\system32\inetsrv\APPCMD.EXE migrate config &lt;Application Path&gt;</font></p>  <p>&#8230;where <font face="Courier New">&lt;Application Path&gt;</font> would be something like <font face="Courier New">&quot;Default Web Site/&quot;</font> or <font face="Courier New">&quot;Default Web Site/someApp&quot;</font>.&#160; If you manually migrate your <font face="Courier New">Web.config</font> and are still getting migration error messages, here is a snippet you can add right under the <font face="Courier New">system.webServer</font> node to disable the error message:</p>  <p><font face="Courier New">&lt;validation validateIntegratedModeConfiguration=&quot;false&quot; /&gt;</font></p>  <p>Also, I want to make note of something I couldn&#8217;t get to work that they showed in the tutorial video.&#160; At about the <font face="Courier New">13:50</font> mark in the video, they go into the <font face="Courier New">Modules</font> section of the UI.&#160; These are the modules of the IIS pipeline for both managed .NET code and unmanaged code.&#160; In order to make their video file hidden behind ASP.NET Forms Authentication, they change a property on two authentication modules to allow these modules to execute on non-managed content as well.&#160; However, this did not work for me for some reason when I was trying to secure HTML pages behind Forms Authentication.&#160; What did work for me (and may have been a drastic solution) was to put the following attribute on the <font face="Courier New">modules</font> node under <font face="Courier New">system.webServer</font>:</p>  <p><font face="Courier New">&lt;modules runAllManagedModulesForAllRequests=&quot;true&quot; /&gt;</font></p>  <p>I believe the issue in my case was their was another few managed modules that I needed to clear that checkbox for in the UI.&#160; But I didn&#8217;t take the time to find out which ones I was missing and opted for the drastic solution.&#160; I will also say there is a way to configure these managed modules through your <font face="Courier New">Web.config</font> so you don&#8217;t have to have your IT Admin configure properties manually in the UI.&#160; In fact, it seems that much of IIS 7 configuration for your website can be done this way.</p>  <h3>A Few Error Messages (and Their Solutions)</h3>  <p>If you get error messages while using the IIS Manager user interface like this&#8230;</p>  <blockquote>   <p>&quot;This feature cannot be used because the default provider type could not be determined to check whether it is a trusted provider.</p>    <p>&quot;You can use this feature only when the default provider is a trusted provider.&#160; If you are a server administrator, you can make a provider a trusted provider by adding the provider type to the trusted providers list in the Administration.config file.&#160; The provider has to be strongly typed and added to the GAC (Global Assembly Cache).&quot;</p> </blockquote>  <p>&#8230;then you should visit the following article for detailed information about resolving the error message:</p>  <ul>   <li><a href="http://www.iis.net/ConfigReference/system.webServer/management/trustedProviders/add">Adding Management Trusted Providers &lt;add&gt;</a> </li> </ul>  <p>Getting rid of this error message is really only for convenience in letting the IIS Manager UI be able to query your database using your providers and give you a basic view of your Membership, Roles, and Profile fields.&#160; Also, if you are trying to find your <font face="Courier New">Administration.config</font> file, it is likely located under the <font face="Courier New">C:\Windows\System32\inetsrv\config\</font> folder.</p>  <p>The other error message I received was not in the IIS Manager UI, but rather when you attempt to view your website in a browser (after you think you got all the configuration bugs out!).&#160; A <font face="Courier New">BadImageFormatException</font> is thrown and the error details say something like this:</p>  <p><font face="Courier New">Could not load file or assembly &#8216;AssemlyNameHere&#8217; or one of its dependencies.&#160; An attempt was made to load a program with an incorrect format.</font></p>  <p>The likely cause of this error is that the assembly referenced in the error message was compiled only for 32-bit machines and you are running a 64-bit operating system.&#160; With Windows Server 2008 x64, the application pools in IIS have an <font face="Courier New">Advanced Setting</font> called <font face="Courier New">Enable 32-Bit Applications</font>, that is disabled by default.&#160; Enable this setting and you&#8217;re probably good to go.&#160; See the following link for more detailed information and some nice screenshots:</p>  <ul>   <li><a href="http://blog.crowe.co.nz/archive/2007/11/05/Could-not-load-file-or-assembly-name-or-one-of.aspx">Could not load file or assembly &#8216;name&#8217; or one of its dependencies</a> </li> </ul>  <h3>Additional Reading</h3>  <p>I just barely noticed that <a href="http://www.4guysfromrolla.com/">4GuysFromRolla.com</a> recently posted an article about the exact same stuff I was attempting to explain.&#160; To read additional details about IIS 7&#8217;s Integrated Pipeline and ASP.NET Forms Authentication with static content, check out the following link:</p>  <ul>   <li><a href="http://aspnet.4guysfromrolla.com/articles/122408-1.aspx">Apply ASP.NET Authentication and Authorization Rules to Static Content with IIS 7.0&#8217;s Integrated Pipeline Feature</a> </li> </ul>  <h3>Conclusion</h3>  <p>I hope you&#8217;ve enjoyed <a title="ASP.NET Providers - Membership, Role, and Profile" href="http://murrayon.net/2009/01/aspnet-providers-membership-role-and.html">this series on the ASP.NET Provider System</a>.&#160; My desire is that you&#8217;ve found these posts helpful in getting you started with implementing such a versatile and customizable model for adding common membership and authorization functionality to your new and existing websites.&#160; There are quite a few advantages in hosting your site on IIS 7 in Windows Server 2008, as I&#8217;ve outlined in this specific post.&#160; Hopefully these discussions about errors and gotchas will also help you get going in no time!</p> </span>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks. Awesome job.</div>
</div>
<div class='comment'>
<div class='author'>Tony</div>
<div class='content'>
Prefect article and thanks for the video links. It helped me understand this whole integrated vs classic iis7 mode and was a refresher on forms authenication.</div>
</div>
<div class='comment'>
<div class='author'>Radek</div>
<div class='content'>
Thanks. This post helped me resolved serious issue with IIS7</div>
</div>
</div>

		
		
	</div>

</article>


    <article class="post">
	<h1 class="title"><a href="/blog/2009/02/11/asp-net-profile-and-web-application-projects/">ASP.NET Profile and Web Application Projects</a></h1>
	<div class="meta">
		<div class="date">








  


<time datetime="2009-02-11T15:08:00-07:00" pubdate data-updated="true">Feb 11<span>th</span>, 2009</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/-net/'>.NET</a>, <a class='category' href='/blog/categories/asp-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/asp-net-providers-series/'>ASP.NET Providers Series</a>, <a class='category' href='/blog/categories/build/'>Build</a>, <a class='category' href='/blog/categories/c-/'>C#</a>, <a class='category' href='/blog/categories/msbuild/'>MSBuild</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>, <a class='category' href='/blog/categories/visual-studio/'>Visual Studio</a>, <a class='category' href='/blog/categories/web/'>Web</a>, <a class='category' href='/blog/categories/windows/'>Windows</a>


</div>
		
			<span class="comments"><a href="/blog/2009/02/11/asp-net-profile-and-web-application-projects/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content">
		<div class='post'>
<p>I talked at length about the ASP.NET <a href="http://en.wikipedia.org/wiki/Provider_model">Provider Model pattern</a> and the ease of implementing several built-in services you can have for free with ASP.NET 2.0 in <a title="ASP.NET Providers - Membership, Role, and Profile" href="http://murrayon.net/2009/01/aspnet-providers-membership-role-and.html">my previous series of posts</a>.&#160; In this post, I will be discussing a few issues I ran into using the Profile system with the <font face="Courier New">Web Application</font> project template instead of the <font face="Courier New">Web Site</font> project template as found in Visual Studio&#8217;s list of default project templates.</p>  <p>The crux of the issue is that Visual Studio doesn&#8217;t automatically generate the <font face="Courier New">Profile</font> proxy class object when using the <font face="Courier New">Web Application</font> project template, like it does with the <font face="Courier New">Web Site</font> project template.&#160; This proxy class can be used to obtain access to strongly-typed properties representing the custom Profile fields you specified in your <font face="Courier New">Web.config</font>.&#160; This is a very convenient way to access a user&#8217;s Profile data, both for authenticated and for anonymous users.</p>  <p>Let&#8217;s discuss the issue a little further and then I will present a workaround that I found and have successfully implemented in my own project.</p> <span class='fullpost'> <h3>VS Project Templates:&#160; Web Site vs. Web Application</h3>  <p>It appears that Microsoft has tried to differentiate these two project templates as much as possible in Visual Studio 2008.&#160; In 2005, you would go to the <font face="Courier New">New Project</font> dialog window and you would see these two <font face="Courier New">Web</font> project templates side-by-side, wondering what difference it would make if you chose one over the other.&#160; However, in Visual Studio 2008, it appears they reworked this whole dialog and menu system for starting a new project so that you would never see these two project templates side-by-side.&#160; In 2008, you have more than one option in the <font face="Courier New">File</font> menu for starting a project; those options are <font face="Courier New">File | New | Project</font> and <font face="Courier New">File | New | Web Site</font>.&#160; The first option is the one that will get you to the <font face="Courier New">ASP.NET Web Application</font> template, while the second takes you to the <font face="Courier New">ASP.NET Web Site</font> project template.</p>  <p>Now as for the differences between these two templates, I&#8217;ll outline a few of the main differences and give a little bit of history of how these two templates came to coexist.&#160; The history in a nutshell is that Visual Studio 2005 came out with the <font face="Courier New">Web Site</font> project template to replace the old, but proven project configuration used by ASP.NET 1.x.&#160; In the opinion of many, the old template better encouraged Object-Oriented design practices.&#160; The new template had no project file for explicitly delineating what files where included in the project and namespacing was quite cumbersome, as the only painless design was to let everything pile up into one big default namespace.&#160; A few other changes involved taking ASP.NET back to compiling on the fly at the web server and also drastically changing the organization of UI template and code-behind files.&#160; It appears the intention was to closely mimic the configuration and deployment practices of popular agile languages like PHP and Ruby on Rails.</p>  <p>In the Service Pack 1 of Visual Studio 2005, Microsoft decided to resurrect the older project template under the name of <font face="Courier New">Web Application</font>.&#160; There is evidence to suggest that Microsoft considers this latter project template an &quot;enterprise&quot; project type, as compared to the casual <font face="Courier New">Web Site</font> project template.&#160; With the advent of Visual Studio 2008, it is apparent that Microsoft is committed to supporting both project types for at least a little while.&#160; For a more detailed discussion of the history and differences of these two project templates, I suggest the following blog post by <a href="http://reddnet.net/code/">Stephen M. Redd</a>:</p>  <ul>   <li><a href="http://reddnet.net/code/aspnet-web-site-vs-web-application/">ASP.NET - Web Site vs. Web Application</a></li> </ul>  <h3>Web Profile Builder by Joe Wrobel</h3>  <p>The ability to retrieve and update your custom Profile fields at design time via strongly-typed properties on the <font face="Courier New">Profile</font> proxy class is extremely convenient.&#160; Unfortunately, you get no such compiler and intellisense love if you are using the <font face="Courier New">Web Application</font> project template for your site.</p>  <p>In trying to find a workaround, I came across a <a title="Web Profile Builder for Web Application Projects" href="http://weblogs.asp.net/joewrobel/archive/2008/02/03/web-profile-builder-for-web-application-projects.aspx">blog post by Joe Wrobel introducing a project he worked on to solve this issue</a>.&#160; It&#8217;s called the <font face="Courier New">Web Profile Builder</font> (here&#8217;s a <a title="Web Profile Builder" href="http://code.msdn.microsoft.com/WebProfileBuilder/Release/ProjectReleases.aspx">link to it&#8217;s project page on MSDN Code Gallery</a>) and it was based on a project called the <a href="http://www.codeplex.com/WebProfile">Web Profile Generator</a>, which was a Visual Studio 2005 Add-In project found on <a href="http://www.codeplex.com/">CodePlex</a>.&#160; The latter project seems to have not been worked on in over a year and a half, nor does it seem to be compatible with Visual Studio 2008.&#160; Hence, Joe feeling the need to start up on his own project, with a few improvements on the side of course.</p>  <p>In Joe&#8217;s introductory post to the project, he mentions he changed the Visual Studio integration from being a plug-in to being an MSBuild Build Task.&#160; The method for incorporating the Build Task into your project is to add a line into your project file (the one with file extension <font face="Courier New">.csproj</font>).&#160; In case you weren&#8217;t aware, Visual Studio project files are just <a href="http://en.wikipedia.org/wiki/MSBuild">MSBuild</a> build scripts.&#160; For details about where to put this line in the file (and about a message Visual Studio pops up when it detects you&#8217;ve mucked with the project file), be sure to check out <a title="Web Profile Builder for Web Application Projects" href="http://weblogs.asp.net/joewrobel/archive/2008/02/03/web-profile-builder-for-web-application-projects.aspx">Joe&#8217;s post on the Web Profile Builder project</a>.</p>  <p>There are a couple of other things I need to point out about using the Build Task that weren&#8217;t entirely clear to me beforehand.&#160; The build task actually generates a C# code file that is intended to be included into your project; once it&#8217;s generated, you need to go to the <font face="Courier New">Solution Explorer</font> and explicitly add it as a file in your project (one way is through the <font face="Courier New">Add | Existing Item</font> menu option).&#160; One of the main things that helped me decide to use this solution and how to configure it was reading two blog posts from <a href="http://www.codersbarn.com/">Anthony Grace</a>; the second post below has a great excerpt apparently from the <font face="Courier New">Web Profile Builder</font> documentation that explains the process I outlined above in a bit more detail:</p>  <ul>   <li><a href="http://www.codersbarn.com/post/2008/06/ASPNET-Web-Site-versus-Web-Application-Project.aspx">ASP.NET: Web Site versus Web Application Project</a></li>    <li><a href="http://www.codersbarn.com/post/2008/07/10/ASPNET-PayPal-Subscriptions-IPN.aspx">ASP.NET PayPal Subscription IPN</a></li> </ul>  <p>Also, it is not necessary to do the steps in the <font face="Courier New">Extended Usage</font> section of Joe&#8217;s blog post.&#160; They are optional configuration points in the <font face="Courier New">Web.config</font> where you control the <font face="Courier New">className</font>, <font face="Courier New">nameSpace</font>, <font face="Courier New">directory</font>, and <font face="Courier New">fileName</font> of the auto-generated code file.&#160; Most of the defaults are fine, but in my case I wanted the generated file to end up in an <font face="Courier New">App_Code</font> directory instead of in the root of the project folder.&#160; If you decide to add in this custom configuration, you need to be aware that you must add the following XML namespace to the <font face="Courier New">configuration</font> root element of your <font face="Courier New">Web.config</font>:</p>  <p><font face="Courier New">xmlns=&quot;http://schemas.microsoft.com/.NetConfiguration/v2.0&quot;</font></p>  <p>Finally, it should be noted that if the website you are building is under source control, you will likely want to always keep this auto-generated code file checked out in order to prevent the file from having its <font face="Courier New">Read-Only</font> attribute set when it&#8217;s checked in.&#160; If you don&#8217;t have it checked out, the build will throw out a warning and the generated code file will not be regenerated if changes in your <font face="Courier New">Web.config</font> need to be propagated to it.</p>  <h3>Conclusion</h3>  <p>With all of this in place, you should be able to use the Profile proxy class object in your ASPX code-behind files, just as I gave examples of in my <a href="http://murrayon.net/2009/02/aspnet-providers-profile.html">previous post about the ASP.NET Profile system</a>.&#160; Although in my case, I mostly used the static method <font face="Courier New">GetProfile</font> from the auto-generated <font face="Courier New">WebProfile</font><font face="Verdana"> class (the name the Visual Studio Build Task selects by default).</font></p>  <p>As I mentioned when <a title="ASP.NET Providers - Membership, Role, and Profile" href="http://murrayon.net/2009/01/aspnet-providers-membership-role-and.html">I first started the ASP.NET Provider Series of posts</a>, my next blog post will be about some advantages of using this Provider system on IIS 7 and a few issues when your ASP.NET website contains non-ASP.NET content:</p>  <ul>   <li><a href="http://murrayon.net/2009/02/iis-7-and-aspnet-providers-membership.html">IIS 7 and ASP.NET Providers (Membership, Roles, and Profile)</a> </li> </ul> </span>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Martena Gaines</div>
<div class='content'>
Web sites are dynamically compiled and source is distributed with them. Web Applications can be compiled into a single DLL and deployed. You cannot use the app_code folder in WAP projects, but you can with WSP.</div>
</div>
</div>

		
		
	</div>

</article>


    <article class="post">
	<h1 class="title"><a href="/blog/2009/02/09/asp-net-providers-profile/">ASP.NET Providers - Profile</a></h1>
	<div class="meta">
		<div class="date">








  


<time datetime="2009-02-09T16:10:00-07:00" pubdate data-updated="true">Feb 9<span>th</span>, 2009</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/-net/'>.NET</a>, <a class='category' href='/blog/categories/asp-net/'>ASP.NET</a>, <a class='category' href='/blog/categories/asp-net-providers-series/'>ASP.NET Providers Series</a>, <a class='category' href='/blog/categories/c-/'>C#</a>, <a class='category' href='/blog/categories/database/'>Database</a>, <a class='category' href='/blog/categories/microsoft/'>Microsoft</a>, <a class='category' href='/blog/categories/sql/'>SQL</a>, <a class='category' href='/blog/categories/visual-studio/'>Visual Studio</a>, <a class='category' href='/blog/categories/web/'>Web</a>


</div>
		
			<span class="comments"><a href="/blog/2009/02/09/asp-net-providers-profile/#disqus_thread">Comments</a></span>
		
	</div>
	<div class="entry-content">
		<div class='post'>
<p>This blog post is part of a series about the ASP.NET Providers (namely Membership, Role Management, and Profile). The introductory post in the series can be found at the following link, which introduces the <a href="http://en.wikipedia.org/wiki/Provider_model">Provider Model pattern</a> and gives a personal example of an implementation I have been working on:</p><ul><li><a href="http://murrayon.net/2009/01/aspnet-providers-membership-role-and.html">ASP.NET Providers - Membership, Role, and Profile</a></li></ul><p>This post will deal with adding Profile properties to your user accounts (and apparently this can also be used with anonymous users as well).&#160; However, I will suggest using a slightly different Profile Provider than what comes in ASP.NET by default.&#160; This will show how easy it is to plug in a different implementation in this very flexible Provider Model.</p> <span class='fullpost'> <h3>SqlProfileProvider vs. SqlTableProfileProvider</h3><p>The <font face="Courier New">SqlProfileProvider</font> is the built-in Profile Provider that ASP.NET comes with by default.&#160; It allows you to define custom fields that make up profiling data you would want to collect and store about your users.&#160; This could be demographics, preferences, or any other useful details.&#160; This specific implementation is designed in a way where no matter what fields you define, your database schema will be compatible with any upgrade Microsoft could send down to patch the Provider system or ASP.NET in general.&#160; The way this is accomplished is by storing a <a title="Binary Large Object" href="http://en.wikipedia.org/wiki/Binary_large_object">blob</a> of all the field names in one table column and a blob of all the field values in another column; it&#8217;s similar to the concept of a <a title="Associative Array" href="http://en.wikipedia.org/wiki/Associative_array">dictionary</a> with key/value pairs.&#160; The difficult part is that these blobs can contain clear-text, XML, and/or binary, depending on how the source data type serializes by default.&#160; Unfortunately, this highly flexible solution is quite unusable if you need a clear view of the Profile data for reporting purposes or stored procedure needs.</p><p>When trying to find an already implemented custom provider that would allow to store each Profile field in its own table column, I came across a <a title="ASP.NET 2.0 SQL Table Profile Provider Released Today" href="http://weblogs.asp.net/scottgu/archive/2006/01/10/435038.aspx">blog post from Scott Guthrie introducing such an implementation done by two Microsoft employees</a>.&#160; The name of this provider is the <font face="Courier New">SqlTableProfileProvider</font>, and it can be found at the following link:</p><p><a href="http://www.asp.net/downloads/sandbox/table-profile-provider-samples/">Table Profile Provider Samples</a></p><p>At the above location, you will find an MSI download that will install a sample project containing a few source code files you can include in your project; you will also find a download link for a &quot;white paper&quot; Word document that explains the usage of the <font face="Courier New">SqlTableProfileProvider</font> and the <font face="Courier New">SqlStoredProcedureProfileProvider</font> custom providers.&#160; The nice thing about both of these providers is that their use in code and their configuration in the Web.config is extremely similar to how the original <font face="Courier New">SqlProfileProvider</font> is used and configured.</p><h3>Setting up the SqlTableProfileProvider</h3><p>As was done with the <a title="ASP.NET Providers - Membership" href="http://murrayon.net/2009/01/aspnet-providers-membership.html">Membership</a> and <a title="ASP.NET Providers - Role Management" href="http://murrayon.net/2009/02/aspnet-providers-role-management.html">Role Management</a> Providers, here is the XML fragment that would go in your <font face="Courier New">Web.config</font>:</p><div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 325px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, &#39;Courier New&#39;, courier, monospace; background-color: #f4f4f4"><pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #0000ff">&lt;</span><span style="color: #800000">configuration</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">connectionStrings</span><span style="color: #0000ff">&gt;</span>
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">=&quot;MyDB&quot;</span> <span style="color: #ff0000">connectionString</span><span style="color: #0000ff">=&quot;...&quot;</span> <span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">connectionStrings</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">system.web</span><span style="color: #0000ff">&gt;</span>
        ... authentication &amp; authorization settings ...
        <span style="color: #0000ff">&lt;</span><span style="color: #800000">profile</span> <span style="color: #ff0000">enabled</span><span style="color: #0000ff">=&quot;true&quot;</span>
                 <span style="color: #ff0000">defaultProvider</span><span style="color: #0000ff">=&quot;ConfiguredProfileProvider&quot;</span><span style="color: #0000ff">&gt;</span>
            <span style="color: #0000ff">&lt;</span><span style="color: #800000">providers</span><span style="color: #0000ff">&gt;</span>
                <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">=&quot;ConfiguredProfileProvider&quot;</span>
                     <span style="color: #ff0000">type</span><span style="color: #0000ff">=&quot;Microsoft.Samples.SqlTableProfileProvider&quot;</span>
                     <span style="color: #ff0000">connectionStringName</span><span style="color: #0000ff">=&quot;MyDB&quot;</span>
                     <span style="color: #ff0000">table</span><span style="color: #0000ff">=&quot;custom_Profile&quot;</span>
                     <span style="color: #ff0000">applicationName</span><span style="color: #0000ff">=&quot;SampleWebSite&quot;</span> <span style="color: #0000ff">/&gt;</span>
            <span style="color: #0000ff">&lt;/</span><span style="color: #800000">providers</span><span style="color: #0000ff">&gt;</span>
            ... properties section found in the next XML snippet ...
        <span style="color: #0000ff">&lt;/</span><span style="color: #800000">profile</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">system.web</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">configuration</span><span style="color: #0000ff">&gt;</span></pre></div><p><strong><u>WARNING</u>: </strong>According to Microsoft, you should <strong><u>never</u></strong> use the default provider settings and should <strong><u>always</u></strong> add a new, configured provider; in addition you <strong><u>must</u></strong> be sure to specify the <font face="Courier New">applicationName</font> attribute! See <a href="http://weblogs.asp.net/scottgu/archive/2006/04/22/Always-set-the-_2200_applicationName_2200_-property-when-configuring-ASP.NET-2.0-Membership-and-other-Providers.aspx">Scott Guthrie&#8217;s blog post on this topic</a> for more details. Apparently, you can also use a value of <font face="Courier New">&quot;/&quot;</font> for the <font face="Courier New">applicationName</font> and it will use the root application name.</p><p>You&#8217;ll notice in the <font face="Courier New">type</font> attribute that we are not referencing the default <font face="Courier New">SqlProfileProvider</font> that ships with ASP.NET.&#160; What you need to do is get this new class included or referenced in your solution so that this namespace reference can successfully resolve.&#160; I opted to just include the code files in my solution as is; I chose to place them in my <font face="Courier New">App_Code</font> folder.&#160; The code files you want to grab are likely in the default location that the MSI installed to, which is <font face="Courier New">Program Files/Microsoft/ASP.NET 2.0 Table Profile Provider Samples</font>.&#160; The two files you need are <font face="Courier New">SqlStoredProcedureProfileProvider.cs</font> and <font face="Courier New">SqlTableProfileProvider.cs</font><font face="Verdana">, </font>both of which are found in the <font face="Courier New">App_Code</font> folder of the sample project.&#160; You need to copy both code files to your solution, as it appears that the <font face="Courier New">SqlTableProfileProvider</font> depends on some logic in the <font face="Courier New">SqlStoredProcedureProfileProvider</font> for some reason.</p><p>Also note the <font face="Courier New">table</font> attribute above (which is not present in the built-in <font face="Courier New">SqlProfileProvider</font>), which tells the provider which table in your database will be storing the custom Profile fields.&#160; As for the &quot;properties section&quot; referenced near the end of the above snippet, this is where you specify the custom Profile fields and their mappings to column names in the specified database table.&#160; The advantage of specifying this information in the <font face="Courier New">Web.config</font> is that you will be able to get programmatic access to these fields as strongly-typed properties on a proxy class named <font face="Courier New">Profile</font> in your code-behind.&#160; Here is a sample <font face="Courier New">properties</font> configuration:</p><div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 300px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, &#39;Courier New&#39;, courier, monospace; background-color: #f4f4f4"><pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #0000ff">&lt;</span><span style="color: #800000">properties</span><span style="color: #0000ff">&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">=&quot;FirstName&quot;</span>
         <span style="color: #ff0000">type</span><span style="color: #0000ff">=&quot;string&quot;</span>
         <span style="color: #ff0000">defaultValue</span><span style="color: #0000ff">=&quot;[null]&quot;</span>
         <span style="color: #ff0000">customProviderData</span><span style="color: #0000ff">=&quot;FirstName;nvarchar&quot;</span> <span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">=&quot;Age&quot;</span>
         <span style="color: #ff0000">type</span><span style="color: #0000ff">=&quot;int&quot;</span>
         <span style="color: #ff0000">customProviderData</span><span style="color: #0000ff">=&quot;Age;int&quot;</span> <span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">=&quot;AccountExpiration&quot;</span>
         <span style="color: #ff0000">type</span><span style="color: #0000ff">=&quot;DateTime&quot;</span>
         <span style="color: #ff0000">defaultValue</span><span style="color: #0000ff">=&quot;[null]&quot;</span>
         <span style="color: #ff0000">customProviderData</span><span style="color: #0000ff">=&quot;AccountExpiration;datetime&quot;</span> <span style="color: #0000ff">/&gt;</span>
    <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">name</span><span style="color: #0000ff">=&quot;CookieID&quot;</span>
         <span style="color: #ff0000">type</span><span style="color: #0000ff">=&quot;System.Guid&quot;</span>
         <span style="color: #ff0000">defaultValue</span><span style="color: #0000ff">=&quot;[null]&quot;</span>
         <span style="color: #ff0000">customProviderData</span><span style="color: #0000ff">=&quot;CookieID;uniqueidentifier&quot;</span> <span style="color: #0000ff">/&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">properties</span><span style="color: #0000ff">&gt;</span></pre></div><p>The Profile system provides a configuration point for each Profile field called <font face="Courier New">customProviderData</font>.&#160; It appears the default <font face="Courier New">SqlProfileProvider</font> doesn&#8217;t even look at this additional attribute, but rather reserves this configuration point for use by custom implemented Profile providers.&#160; The <font face="Courier New">SqlTableProfileProvider </font>utilizes this extra metadata field as a place to put mapping information for a column name and ADO.NET database type.&#160; If you have questions about which ADO.NET and .NET types to use/specify in this configuration, there is helpful information in the accompanying white paper found on the download site.&#160; Also found in that document is a great discussion you may want to read about the <font face="Courier New">defaultValue</font> attribute, what it configures, and how it might differ for value types (such as <font face="Courier New">integer</font>).</p><h3>Creating the Database Table</h3><p>Now that you have the code files in your solution and have configured the Profile fields, you need to create the custom table in the database that this provider will query and update.&#160; Here is a sample SQL definition for our custom profile table:</p><div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, &#39;Courier New&#39;, courier, monospace; background-color: #f4f4f4"><pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #0000ff">create</span> <span style="color: #0000ff">table</span> dbo.custom_Profile
(
    UserId               uniqueidentifier <span style="color: #0000ff">not</span> <span style="color: #0000ff">null</span> <span style="color: #0000ff">Primary</span> <span style="color: #0000ff">Key</span>,
    FirstName            nvarchar(50) <span style="color: #0000ff">null</span>,
    Age                  <span style="color: #0000ff">int</span> <span style="color: #0000ff">null</span>,
    AccountExpiration    datetime <span style="color: #0000ff">null</span>,
    CookieID             uniqueidentifier <span style="color: #0000ff">null</span>,
    LastUpdatedDate      datetime <span style="color: #0000ff">not</span> <span style="color: #0000ff">null</span>
)
go</pre></div><p>Note that the <font face="Courier New">SqlTableProfileProvider</font> requires two extra columns in addition to your custom defined Profile properties, namely <font face="Courier New">UserId</font> and <font face="Courier New">LastUpdatedDate</font>.&#160; One other thing to be aware of is that if you use the Membership API to delete a user programmatically, this will remove all entries related to that user in the database <strong><u>except</u></strong> from your custom Profile table.&#160; I believe this might be because the Profile system can apparently be used independently of the Membership system, even allowing you to store Profile data on anonymous, unauthenticated users.&#160; I think the same caution would go for any utility that presumably uses this Membership API under the covers, such as the <font face="Courier New">ASP.NET Website Administration Tool</font> launched from Visual Studio that I referred to earlier in this series with a post titled <a href="http://murrayon.net/2009/01/aspnet-providers-getting-started.html">ASP.NET Providers - Getting Started</a>.&#160; Up to this point, I have resorted to manually clearing out Profile table rows myself that are linked to the membership account being removed from the database.</p><p>Also, if your web site is using a Windows user or system account for the identity of the worker process, you&#8217;ll want to make sure that set of credentials has <font face="Courier New">SELECT</font>, <font face="Courier New">INSERT</font>, <font face="Courier New">UPDATE</font>, and <font face="Courier New">DELETE</font> permissions granted to it for this new custom database table you created.&#160; There are also some <font face="Courier New">EXECUTE</font>, <font face="Courier New">SELECT</font>, and <font face="Courier New">UPDATE</font> permissions required on a few of the already-existing stored procedures that the Provider system uses.&#160; Again, check the accompanying white paper on the download site for a discussion about these procedure and for some SQL statements to help you automate the granting of these permissions.</p><h3>The Profile Proxy Class</h3><p>If you are using the <font face="Courier New">Web Site</font> project template in Visual Studio, then you are good to go with using the <font face="Courier New">Profile</font> proxy class that can be used anywhere in your code to retrieve and update Profile fields on the current user.&#160; The availability of this <font face="Courier New">Profile</font> class is independent of whether you are using the built-in ASP.NET <font face="Courier New">SqlProfileProvider</font> or the custom <font face="Courier New">SqlTableProfileProvider</font> that I&#8217;ve been showcasing thus far.&#160; However, if you are using the <font face="Courier New">Web Application</font> project template, this proxy object is not auto-generated for you by Visual Studio.&#160; For a detailed discussion of the problem and a working solution, see my next post which is entitled <a href="http://murrayon.net/2009/02/aspnet-profile-and-web-application.html">ASP.NET Profile and Web Application Projects</a>.</p><p>Use of this <font face="Courier New">Profile</font> class couldn&#8217;t be easier and is exactly as you would expect it to be.&#160; Here is a code snippet that both retrieves and updates strongly-typed Profile properties (exactly as they were defined in the <font face="Courier New">Web.config</font>) using this proxy object:</p><div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, &#39;Courier New&#39;, courier, monospace; background-color: #f4f4f4"><pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, &#39;Courier New&#39;, courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #008000">// Set Profile property</span>
Profile.FirstName = txtBoxFirstName.Text;

<span style="color: #008000">// Retrieve Profile property</span>
<span style="color: #0000ff">int</span> age = Profile.Age;</pre></div><h3>Read On!</h3><p>This crash course of the ASP.NET Provider system is pretty much done I guess you could say, as far as a tutorial goes that is.&#160; I still have another two posts on the radar that will be coming over the next few days regarding issues and workarounds that I encountered.&#160; One post will deal with generating this <font face="Courier New">Profile</font> proxy class under the Visual Studio <font face="Courier New">Web Application</font> project template.&#160; The other post will be about the advantages of using this system under IIS 7 found in Windows Vista and Server 2008; it will also include some issues with using this system if some of your content is static HTML instead of ASPX pages.&#160; Here are the links to these two posts:</p><ul><li><a href="http://murrayon.net/2009/02/aspnet-profile-and-web-application.html">ASP.NET Profile and Web Application Projects</a> </li><li><a href="http://murrayon.net/2009/02/iis-7-and-aspnet-providers-membership.html">IIS 7 and ASP.NET Providers (Membership, Roles, and Profile)</a> </li></ul><p>It has been a very pleasant experience overall to work with the ASP.NET Provider system because of it&#8217;s highly customizable and flexible design.&#160; If your <a title="ASP.NET Providers - Membership" href="http://murrayon.net/2009/01/aspnet-providers-membership.html">Membership</a>, <a title="ASP.NET Providers - Role Management" href="http://murrayon.net/2009/02/aspnet-providers-role-management.html">Role Management</a>, and Profile needs are fairly common and typical, this framework is a piece of cake to incorporate into your product (including your existing ones, no matter how out-of-date they are).&#160; Hope you&#8217;ve enjoyed the series!</p>
</span>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>mamali</div>
<div class='content'>
perfect, thank you very much&#8230;</div>
</div>
<div class='comment'>
<div class='author'>Bryan</div>
<div class='content'>
I&#39;ve been using the profile system with good results, but in the last couple of weeks, I must have made some change because now I&#39;m getting the error: &quot;Column name &#39;UserID&#39; appears more than once in the result column list.&quot; I can see the SQL command that&#39;s generated in SqlTableProfileProvider.vb, and it indeed contains two columns with name UserID. The problem is, I&#39;m unable to find the source of the second UserID column. What can I do to trace and resolve the problem?</div>
</div>
<div class='comment'>
<div class='author'>Esteban Araya</div>
<div class='content'>
@Shalan &amp; Mike:<br /><br />I&#39;d just store the photo on a file server, and then just store a UNC path to the photo on the custom profile table.<br /><br />That way, all you&#39;d have to do is: read the path, load the photo &amp; display it.<br /><br />Hope this helps!</div>
</div>
<div class='comment'>
<div class='author'>Mike Murray</div>
<div class='content'>
Ya know, I&#39;m not really sure.  But I am wondering if I&#39;ve got something that might lead to an answer.  I&#39;m looking at the examples in my blog post and notice the Guid field.  In order for that data type to work, it had to be specified as System.Guid, I&#39;m assuming because it&#39;s not a primitive type.  Perhaps something similar has to be done, like System.Array or System.Array&lt;Byte&gt;&#8230;not really sure.  The other thing I can think of is maybe using the primitive version of &quot;byte&quot; instead of &quot;Byte&quot;.<br /><br />Just a few random guesses.  Let us know if you find the resolution and post back here.  Thanks!</div>
</div>
<div class='comment'>
<div class='author'>shalan</div>
<div class='content'>
Hi Mike.  Excellent article! I&#8217;ve been using TableProvider for some time now, but recently I had a first case where the user wanted to incorporated photos as part of their profile.<br /><br />I have tried to accomplish but to no avail. Its setup as a varbinary field in the database, and a Byte[] datatype in the web.config, but I keep getting an error saying that it could not load type &#8220;Byte[]&#8221;.  Have you tried this?  Do you have any suggestions?<br /><br />Thanx!</div>
</div>
<div class='comment'>
<div class='author'>Mike Murray</div>
<div class='content'>
Very good question.<BR/><BR/>In my particular use case, the need to delete a user account from the system would be so rare that I am content to leave it a manual process.  And since I&#8217;ll be the one managing it for a while, I&#8217;m content with this solution for the time being.<BR/><BR/>I will give this question some thought, however, and I will post back if come up with an idea or two&#8230;that is if someone else doesn&#8217;t beat me to it here in the comments.<BR/><BR/>Please do let us know if you come up with something yourself.  Thanks, and good luck.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Has anybody came up with a way to automatically delete custom profile table along with the rest of the membership information?</div>
</div>
</div>

		
		
	</div>

</article>

<nav id="pagenavi">
    
        <a href="/blog/page/5/" class="prev">Prev</a>
    
    
        <a href="/blog/page/7/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2012

    Mike Murray


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'mkmurray';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-36228026-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



		</div>
		<div class="left-col">
			<header id="header" class="inner"><div class="profilepic">	
	<img src="/images/mkmurray.jpg" alt="Profile Picture">
</div>
<h1><a href="/">Mike Murray</a></h1>
<nav id="main-nav"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

<br />
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mkmurray.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

</nav>
<br/>
<h3 class="alignleft">please code responsibly</h3>
<br/>
<br/>
<br/>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		<a class="facebook" href="http://www.facebook.com/mkmurray" title="Facebook">Facebook</a>
		
		
		<a class="google" href="https://plus.google.com/109073345657761090655?rel=author" title="Google+">Google+</a>
		
		
		<a class="twitter" href="http://twitter.com/mkmurray" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/mkmurray" title="GitHub">GitHub</a>
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/mkmurray">LinkedIn</a>
		
		
		
		
		<a class="rss" href="http://feeds.feedburner.com/mkmurray/" title="RSS">RSS</a>
		
	</div>
</nav>

</header>				
		</div>	
	</div>
</body>
</html>
